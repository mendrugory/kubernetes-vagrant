---

- name: Installing prerequisites
  apt:
    update_cache: yes
    pkg:
      - apt-transport-https
      - ca-certificates
      - software-properties-common

- name: Adding Docker apt key
  ansible.builtin.apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
    state: present

- name: Adding Docker APT repository
  apt_repository: repo='deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable'

- name: Installing Docker
  apt: name=docker-ce={{ version }} update_cache=yes force=yes

- name: Setup insecure docker registry
  template:
    src: docker-daemon.json.j2
    dest: /etc/docker/daemon.json
  notify:
    - restart docker service
